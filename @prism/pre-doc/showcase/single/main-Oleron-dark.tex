% !TEX TS-program = lualatex

\documentclass[theme = dark]{tutodoc}

\newcommand{\PALETTE}{Oleron}
\newcommand{\SRC}{Source: Scientific Colour Maps}


\geometry{
  top    = 1cm,
  bottom = 1cm,
  left   = 1cm,
  right  = 1cm,
%  showframe
}

\usepackage{pgfpages}
\pgfpagesuselayout{2 on 1}[
  a4paper,
  landscape
]

\usepackage[svgnames]{xcolor}
\usepackage[3d]{luadraw}
\usepackage{fourier}


\begin{document}

\pagestyle{empty}
\centering


% -------------------------- %
% -- COMMON LUA CODE USED -- %
% -------------------------- %

\directlua{dofile('../../../products/luadraw/palettes.lua')}


\directlua{
  PALNAME = "\PALETTE"
  PALETTE = getPal(PALNAME)

  PALSIZE = 10

  PALDIM   = 1
  PALDELTA = .3

  xmin, xmax = -100, 100

  COL_1 = "lightgray!95"
  COL_2 = "lightgray!20!black"
}


% ------------------ %
% -- PALETTE NAME -- %
% ------------------ %

{\Huge\bfseries\PALETTE\vphantom{g}}

\medskip

{\itshape \SRC}


% ----------------------- %
% -- DISCRETE SPECTRUM -- %
% ----------------------- %

\bigskip
\bigskip

\begin{luadraw}{name = showcase-palette-\PALETTE-std}
local g = graph:new{
  window = {xmin, xmax, -5, 5},
  bbox   = false
}

g:Linewidth(10)

local A = Z(-20, 4)
local v = Z(0, -PALDIM)

for k = 1, PALSIZE do
  local color = rgb(PALETTE[k])

  g:Drectangle(
    A, A + PALDIM, A + PALDIM + v,
    "color = " .. COL_1 .. ", fill = " .. color
  )

  g:Dlabel(
    "\\Large$" .. k .. "$",
    A + Z(PALDIM, 1.15*PALDIM) / 2,
    {pos="S"}
  )

  A = A + PALDIM + PALDELTA
end

g:Show()
\end{luadraw}


% ------------------------- %
% -- CONTINUOUS SPECTRUM -- %
% ------------------------- %

\bigskip
\bigskip

\begin{luadraw}{name = showcase-spectrum-\PALETTE-std}
-- Let's work!
local g = graph:new{
  window = {xmin, xmax, -5, 5},
  bbox   = false
}

g:Linewidth(10)

local A  = Z(-5, 4)
local h  = Z(0, -1.5)
local dh = Z(0, -1.1)

local L = PALDIM * PALSIZE + PALDELTA * (PALSIZE - 1)
local N = 100

local dl = L / N

for k = 1, N do
  local color = palette(PALETTE, (k - 1) / (N - 1))

  g:Drectangle(
    A, A + h, A + h + dl,
    "color = " .. color .. ", fill = " .. color
  )

  A = A + dl
end

g:Drectangle(
  A, A + h, A + h - L,
  "color = " .. COL_1
)

g:Show()
\end{luadraw}


% ---------------------- %
% -- PRETTY NEFERTITI -- %
% ---------------------- %

\vfill

\begin{luadraw}{name = showcase-nefertiti-\PALETTE-std}
local file = "../core/nefertiti.obj"

local polyhedron, bounding_box = read_obj_file(file)

local g = graph3d:new{
  window3d = bounding_box,
  window   = {-5, 4, -7, 5},
  viewdir  = {35, 60},
  size     = {22, 22},
  bbox     = false
}

g:Dpoly(
  polyhedron,
  {
    usepalette = {PALETTE, "z" },
    mode       = mShadedOnly
  }
)

g:Show()
\end{luadraw}


% ------------------------- %
% -- CONTINUOUS SPECTRUM -- %
% ------------------------- %

\newpage

\begin{luadraw}{name = showcase-contour-\PALETTE-std}
local g = graph:new{
  window = {-1, 6.5, -1.5, 11},
  size   = {16, 14, 0},
  margin = {0, 0, 0, 0},
  bbox   = false
}

local i = cpx.I

local sin, cos = math.sin, math.cos

local f = function(x, y)
  return (x + y) / (2 + cos(x)*sin(y))
end

local Lz = range(1, 10)

local colors = getpalette(PALETTE, 10)

g:Linewidth(3)

g:Dgradbox(
  {0, 5 + 10*i, 1, 1},
  {
    grid         = true,
    gridcolor    = COL_1,
    subgridcolor = COL_2
  }
)

g:Linewidth(20)

g:Dcontour(
  f,
  Lz,
  {
    view   = {0, 5, 0, 10},
    colors = colors
  }
)

for k = 1, 10 do
  local y = (2*k + 4) / 3*i

  g:Dseg(
    {5.25 + y, 5.5 + y},
    1,
    "color = " .. colors[k]
  )

  g:Labelcolor(colors[k])

  g:Dlabel(
    "$z = " .. k .. "$",
    5.5 + y,
    {pos = "E"}
  )
end

g:Show()
\end{luadraw}


% ------------------ %
% -- LEVEL SURFACE-- %
% ------------------ %

\vfill

\begin{luadraw}{name = showcase-level-surface-\PALETTE-std}
local cos, sin = math.cos, math.sin, math.pi

local g = graph3d:new{
  window3d = {0, 5, 0, 10, 0, 11},
  adjust2d = true,
  size     = {11.5, 9.5, 0},
  bbox     = false,
  viewdir  = {220, 60},
  margin   = {0, 0, 0, 0}
}

g:Linewidth(2)

local S = surface(
  function(u, v)
    return M(u, v, (u + v) / (2 + cos(u)*sin(v)))
  end,
  0, 5, 0, 10,
  {30, 30}
)

local n = 10

local colors = getpalette(PALETTE, n, true)

local niv, S1 = {}

for k = 1, n do
  S1, S = cutfacet(S, {M(0, 0, k), -vecK})

  insert(
    niv,
    {
      S1,
      {
        color     = colors[k],
        mode      = mShaded,
        edgewidth = 0.5
      }
    }
  )
end

insert(
  niv,
  {
    S,
    {color = colors[n + 1]}
  }
)

g:Linewidth(7)

g:Dboxaxes3d({
  grid      = true,
  gridcolor = COL_1,
  fillcolor = COL_2
})

g:Dmixfacet(table.unpack(niv))

for k = 1, n do
  g:Dballdots3d(
    M(5, 0, k),
    rgb(colors[k])
  )
end

g:Show()
\end{luadraw}

\end{document}
